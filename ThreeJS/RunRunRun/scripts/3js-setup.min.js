function render(){if(target){requestAnimationFrame(render);var e=performance.now();if(renderData=updateControls(renderData,e,prevTime,target_player),updatePosition(invader),activeObjects.length)for(var a=0;a<activeObjects.length;a++)updatePosition(activeObjects[a]);TweenLite.to(light.position,updateData.light.time,{x:target_player.body.position.x+updateData.light.position.x,y:target_player.body.position.y+updateData.light.position.y,z:target_player.body.position.z+updateData.light.position.z,ease:Elastic.easeOut}),TweenLite.to(camera.position,updateData.camera.time,{x:target_player.body.position.x+updateData.camera.position.x,y:target_player.body.position.y+updateData.camera.position.y,z:target_player.body.position.z+updateData.camera.position.z,ease:Elastic.easeOut});var t=coordinatesBetween(target_player.body.position,target_invader.body.position);$("#direction #arrow").css("transform","rotate("+t.rotation.xz+"deg)"),$("#direction #distance").text(round(t.distance,0)+" km"),$("#direction #distance").css("font-size",(round(t.distance,0)-zoneDistance)/5+"px"),$("#direction #distance").css("line-height",(round(t.distance,0)-zoneDistance)/5+"px"),t.distance<zoneDistance?(target=target_invader.body,timeCam=updateData.camera.time,CamX=updateData.camera.position.x+CamDist,CamY=updateData.camera.position.y+CamDist,CamZ=updateData.camera.position.z+CamDist,$("#direction #arrow").text("adjust")):(target=target_player.body,timeCam=.5*updateData.camera.time,CamX=updateData.camera.position.x,CamY=updateData.camera.position.y,CamZ=updateData.camera.position.z,$("#direction #arrow").text("straight")),TweenLite.to(light.position,updateData.light.time,{x:target_player.body.position.x+updateData.light.position.x,y:target_player.body.position.y+updateData.light.position.y,z:target_player.body.position.z+updateData.light.position.z,ease:Elastic.easeOut}),TweenLite.to(camera.position,updateData.camera.time,{x:target_player.body.position.x+CamX,y:target_player.body.position.y+CamY,z:target_player.body.position.z+CamZ,ease:Elastic.easeOut}),TweenLite.to(pos,timeCam,{x:target_player.body.position.x,y:target_player.body.position.y,z:target_player.body.position.z,ease:Elastic.easeOut}),floor.model.position.x=pos.x,floor.model.position.z=pos.z,camera.lookAt(pos.x,pos.y,pos.z),light.target=target,world.step(physicsParams.time),renderer.render(scene,camera),prevTime=e}}const $html=document.documentElement;var target_player,target_invader,target;console.clear();var son,spanRadio=40,load=!1,colors=[["red","#f93d4d"],["orange","#fb5607"],["yellow","#ffbe0b"],["green","#8ac926"],["cyan","#3da5d9"],["blue","#3a86ff"],["purple","#8338ec"],["pink","#ff006e"],["grey","#8392a6"],["black","#22272f"]],mainColor=colors[Math.floor(Math.random()*colors.length)][0],subColor=colors[Math.floor(Math.random()*colors.length)][0];createCSSColors(colors),createColorButtons("mainColor","#mainColor",colors),createColorButtons("subColor","#subColor",colors);var invader,audioS={audio:"./media/music/stompinFeet/mix.mp3",loop:!1,volume:1,autostart:!0,startTime:0,reverse:!1},sceneParams={color:mainColor,fog:mainColor,near:.1,far:50,id:"scene"},sceneData=createScene(sceneParams),scene=sceneData.scene,renderer=sceneData.renderer,cameraParams={type:"perspective",target:{x:0,y:0,z:0},position:{x:0,y:10,z:100},properties:{fov:75,near:.1,far:100},id:sceneParams.id},camera=createCamera(cameraParams),lightParams={type:"point",scene:scene,color:"#ffffff",intensity:1,mapSize:2048,near:.5,far:100,position:{x:20,y:20,z:20},target:{x:0,y:0,z:0},guide:!1,shadow:!0},ambientLightParams={type:"ambient",scene:scene,color:"#ffffff",intensity:.5,mapSize:2048,near:.5,far:100,position:{x:20,y:20,z:20},target:{x:0,y:0,z:0},guide:!1,shadow:!1},light=addLight(lightParams),ambientLight=addLight(ambientLightParams),gravity=29.46,physicsParams={gravity:{x:0,y:-gravity,z:0},time:1/30},world=setPhysics(physicsParams),floorParams={scene:scene,size:{width:150,height:150},position:{x:0,y:0,z:0},rotation:{x:-Math.PI/2,y:0,z:0},scale:{x:1,y:1,z:1},shadow:!1,color:subColor,receive:!0,shape:"plane"},floor=createPrimitive(floorParams),cars=Object.entries(models.car),invaderPosition=2*spanRadio,invaderParams={path:cars[random(0,cars.length-1,0)][1],scene:scene,physics:{mass:10,world:world},position:{x:random(-invaderPosition,invaderPosition,0),y:random(invaderPosition,5*invaderPosition,0),z:random(-invaderPosition,invaderPosition,0)},shadow:!0};createModel(invaderParams).then(e=>{invader=e,target_invader=invader});var player,playerPosition=spanRadio,playerParams={path:cars[random(0,cars.length-1,0)][1],scene:scene,physics:{mass:10,world:world},shadow:!0};createModel(playerParams).then(e=>{player=e,target_player=player,target=target_player,colorChange(mainColor,"mainColor"),colorChange(subColor,"subColor")});for(var activeModels=Object.entries(models.active),activeModelsPosition=spanRadio,activeModelsTotal=200,activeObjects=[],activeObjectsParams=[],i=0;i<activeModelsTotal;i++)(function(e){var a={scene:scene,physics:{mass:5,world:world},shadow:!0,path:activeModels[random(0,activeModels.length-1,0)][1],position:{x:random(-activeModelsPosition,activeModelsPosition,2),y:random(1,2,2),z:random(-activeModelsPosition,activeModelsPosition,2)},rotation:{x:random(-360,360,2),y:random(-360,360,2),z:random(-360,360,2)}};createModel(a).then(a=>{activeObjects[e]=a})})(i);var params={models:models,activeObjects:activeObjects,floor:floor,invader:invader};console.log(params);var timeCam,CamX,CamY,CamZ,velocity=new THREE.Vector3,direction=new THREE.Vector3,prevTime=performance.now(),updateData={multiply:{speed:250,position:.005,rotation:10},character:{velocity:{x:0,y:0,z:0},position:{x:0,y:0,z:0,r:0},angle:0},camera:{position:{x:5,y:10,z:10},rotation:{x:0,y:0,z:0},time:5},light:{position:{x:0,y:20,z:0},time:30},delta:1/60,time:0},renderData={speed:200,position:.005,rotation:.5,delta:1/30,velocity:new THREE.Vector3,direction:new THREE.Vector3,camera:{position:{x:5,y:10,z:10},rotation:{x:0,y:0,z:0},time:5},light:{position:{x:0,y:20,z:0},time:30}},pos={x:0,y:0,z:0},zoneDistance=spanRadio,CamDist=2;